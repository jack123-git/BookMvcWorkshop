USE [GSSWEB]
GO
/****** Object:  StoredProcedure [dbo].[TP_SELECT_BOOK_LEND_RECORD]    Script Date: 2024/11/15 05:50:12 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- 查詢單筆資料 SP
IF OBJECT_ID('TP_SELECT_BOOK_DATA','P') IS NOT NULL
	DROP PROC TP_SELECT_BOOK_DATA
GO

CREATE PROCEDURE [dbo].[TP_SELECT_BOOK_DATA] (
@BOOK_ID INT)
AS
BEGIN
	SELECT * FROM dbo.BOOK_DATA
    WHERE BOOK_ID = @BOOK_ID
END

----資料表 dbo.BOOK_DATA----
-- 新增單筆資料 SP
IF OBJECT_ID('TP_CREATE_BOOK_DATA','P') IS NOT NULL
	DROP PROC TP_CREATE_BOOK_DATA
GO

CREATE PROCEDURE [dbo].[TP_CREATE_BOOK_DATA] (
@BOOK_NAME NVARCHAR(200),
@BOOK_CLASS_ID NVARCHAR(4),
@BOOK_AUTHOR NVARCHAR(30),
@BOOK_BOUGHT_DATE DATETIME,
@BOOK_PUBLISHER NVARCHAR(20),
@BOOK_NOTE NVARCHAR(1200),
@BOOK_STATUS CHAR(1),
@BOOK_KEEPER NVARCHAR(12)
)
AS
BEGIN
	INSERT INTO dbo.BOOK_DATA ([BOOK_NAME],[BOOK_CLASS_ID],[BOOK_AUTHOR],[BOOK_BOUGHT_DATE],[BOOK_PUBLISHER],[BOOK_NOTE],[BOOK_STATUS],[BOOK_KEEPER]) 
	VALUES (@BOOK_NAME,@BOOK_CLASS_ID,@BOOK_AUTHOR,@BOOK_BOUGHT_DATE,@BOOK_PUBLISHER,@BOOK_NOTE,@BOOK_STATUS,@BOOK_KEEPER) 
END

-- 更新單筆資料 SP
IF OBJECT_ID('TP_UPDATE_BOOK_DATA','P') IS NOT NULL
	DROP PROC TP_UPDATE_BOOK_DATA
GO

CREATE PROCEDURE [dbo].[TP_UPDATE_BOOK_DATA] (
@BOOK_ID INT,
@BOOK_NAME NVARCHAR(200),
@BOOK_CLASS_ID NVARCHAR(4),
@BOOK_AUTHOR NVARCHAR(30),
@BOOK_BOUGHT_DATE DATETIME,
@BOOK_PUBLISHER NVARCHAR(20),
@BOOK_NOTE NVARCHAR(1200),
@BOOK_STATUS CHAR(1),
@BOOK_KEEPER NVARCHAR(12)
)
AS
BEGIN
	UPDATE dbo.BOOK_DATA SET [BOOK_NAME] = @BOOK_NAME,[BOOK_CLASS_ID] = @BOOK_CLASS_ID,[BOOK_AUTHOR] = @BOOK_AUTHOR,[BOOK_BOUGHT_DATE] = @BOOK_BOUGHT_DATE,[BOOK_PUBLISHER] = @BOOK_PUBLISHER,[BOOK_NOTE] = @BOOK_NOTE,[BOOK_STATUS] = @BOOK_STATUS,[BOOK_KEEPER] = @BOOK_KEEPER
    WHERE BOOK_ID = @BOOK_ID
END

-- 刪除單筆資料 SP
IF OBJECT_ID('TP_DELETE_BOOK_DATA','P') IS NOT NULL
	DROP PROC TP_DELETE_BOOK_DATA
GO

CREATE PROCEDURE [dbo].[TP_DELETE_BOOK_DATA] (
@BOOK_ID INT)
AS
BEGIN
	DELETE FROM dbo.BOOK_DATA
    WHERE BOOK_ID = @BOOK_ID
END

----資料表 dbo.BOOK_LEND_RECORD----
-- 新增單筆資料 SP
IF OBJECT_ID('TP_CREATE_BOOK_LEND_RECORD','P') IS NOT NULL
	DROP PROC TP_CREATE_BOOK_LEND_RECORD
GO

CREATE PROCEDURE [dbo].[TP_CREATE_BOOK_LEND_RECORD] (
@BOOK_ID INT,
@KEEPER_ID NVARCHAR(12),
@LEND_DATE DATETIME
)
AS
BEGIN
	INSERT INTO dbo.BOOK_LEND_RECORD ([BOOK_ID],[KEEPER_ID],[LEND_DATE]) 
	VALUES (@BOOK_ID,@KEEPER_ID,@LEND_DATE)
END

-- 查詢單筆借閱紀錄 SP
IF OBJECT_ID('TP_SELECT_BOOK_LEND_RECORD','P') IS NOT NULL
	DROP PROC TP_SELECT_BOOK_LEND_RECORD
GO

CREATE PROCEDURE [dbo].[TP_SELECT_BOOK_LEND_RECORD] (
@BOOKID INT)
AS
BEGIN
	SELECT A.BOOK_ID, A.LEND_DATE, B.[USER_ID], B.USER_ENAME, B.USER_CNAME
	FROM dbo.BOOK_LEND_RECORD A
	LEFT JOIN MEMBER_M B ON A.KEEPER_ID = B.[USER_ID]
    WHERE A.BOOK_ID = @BOOKID
END